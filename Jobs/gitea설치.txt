다음은 Rocky Linux 9.4 환경에서 PostgreSQL 15가 설치된 상태에서 Gitea 형상관리 시스템을 구축하는 전체 절차입니다.

---

## ✅ 1. Gitea 설치 준비

```bash
sudo dnf update -y
sudo dnf install -y git wget tar
```

---

## ✅ 2. Gitea 전용 사용자 생성

```bash
sudo adduser \
  --system \
  --shell /bin/bash \
  --comment 'Gitea Service Account' \
  --create-home \
  --home-dir /home/gitea \
  gitea
```

---

## ✅ 3. Gitea 바이너리 다운로드 및 설치

```bash
wget -O /usr/local/bin/gitea https://dl.gitea.io/gitea/1.21.11/gitea-1.21.11-linux-amd64
chmod +x /usr/local/bin/gitea
```

---

## ✅ 4. 디렉터리 구성 및 권한 설정

```bash
sudo mkdir -p /var/lib/gitea/{custom,data,log}
sudo chown -R gitea:gitea /var/lib/gitea/
sudo chmod -R 750 /var/lib/gitea/

sudo mkdir -p /etc/gitea
sudo chown root:gitea /etc/gitea
sudo chmod 770 /etc/gitea
```

---

## ✅ 5. PostgreSQL 계정 및 DB 생성

```bash
sudo -u postgres psql

CREATE USER gitea WITH PASSWORD 'dktkekf0215@#';
CREATE DATABASE gitea OWNER gitea;
\q
```

### 인증 방식 확인

`/var/lib/pgsql/15/data/pg_hba.conf` 파일에서 아래처럼 설정되어 있어야 합니다:
```
local   all             all                                     md5
```
이후 PostgreSQL 재시작:
```bash
sudo systemctl restart postgresql-15
```

---

## ✅ 6. Gitea systemd 서비스 등록

```bash
sudo tee /etc/systemd/system/gitea.service > /dev/null << 'EOF'
[Unit]
Description=Gitea (Git with a cup of tea)
After=network.target

[Service]
RestartSec=2s
Type=simple
User=gitea
Group=gitea
WorkingDirectory=/var/lib/gitea/
ExecStart=/usr/local/bin/gitea web --config /etc/gitea/app.ini
Restart=always
Environment=USER=gitea HOME=/home/gitea GITEA_WORK_DIR=/var/lib/gitea

[Install]
WantedBy=multi-user.target
EOF
```

```bash
sudo systemctl daemon-reexec
sudo systemctl daemon-reload
sudo systemctl enable --now gitea
```

---

## ✅ 7. Firewall 포트 개방

```bash
sudo firewall-cmd --permanent --add-port=3000/tcp
sudo firewall-cmd --reload
```

---

## ✅ 8. Gitea 초기 설정 (웹 UI)

브라우저에서 접속:
```
http://<서버IP>:3000
```

### 설정 항목 예시:
- DB Type: `PostgreSQL`
- Host: `127.0.0.1:5432`
- User: `gitea`
- Password: `gitea1234`
- Database Name: `gitea`

관리자 계정도 이 과정에서 함께 생성할 수 있습니다.

---

✅ Gitea 설치 완료 후 할 일:
- 저장소 생성 후 로컬에서 `git clone` 하여 사용
- 필요 시 Drone CI 연동하여 자동 배포 구성
- SSH 키 등록 또는 HTTPS 인증 설정
- 정기 백업 스크립트 구성 (cron 등)

